<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Mapping electricity with D3</title>
		<script type="text/javascript" src="d3/d3.min.js"></script>
		<style type="text/css">
			h1 {
		font-size: 30px;
		color: darkgray;
		}
		.axis path,
		.axis line {
  			fill: none;
  			stroke: #000;
  			shape-rendering: crispEdges;
		}

		.x.axis path {
  			display: none;
		}

		.line {
  			fill: none;
  			stroke: steelblue;
  			stroke-width: 2px;
		}
		.tempLine {
			fill: none;
			stroke: firebrick;
			stroke-width:1px;
			stroke-dasharray:5,5;
		
		</style>
	</head>
	<body>
	<h1>Interactive plot of electricity use over time in Boston</h1>
	<form>
  		<label><input type="radio" name="city" value="0" checked> January-June</label>
  		<label><input type="radio" name="city" value="1"> July-December</label>
	</form>
	<script type="text/javascript">
		//Width and height all in px
		var w = 1000;
		var h = 500;
		var margin=50;
		
		svg=d3.select("body").append("svg")
			.attr("width",w)
			.attr("height",h);
		
		var xScale = d3.time.scale().range([margin,(w-margin)]);
		var yScale = d3.scale.linear().range([(h-margin),margin]);
		var tempScale = d3.scale.linear().range([(h-margin),margin]);
		
		var xAxis = d3.svg.axis().scale(xScale).orient("bottom");
		var yAxis = d3.svg.axis().scale(yScale).orient("left");
		var tempAxis = d3.svg.axis().scale(tempScale).orient("right");
		
		var parseDate = d3.time.format("%m/%d/%Y %H").parse;
		
		var valueLine = d3.svg.line()
			.x(function(d){return xScale(d.Date);})
			.y(function(d){return yScale(d.NEMA);});
			
		var tempLine = d3.svg.line()
			.x(function(d){return xScale(d.Date);})
			.y(function(d){return tempScale(d.NEMATemp);});
			
		d3.csv("data/cleaned_demand.csv", function(error,data){
			data.forEach(function(d) {
				d.Date = parseDate(d.Date+' '+d.Hour);
				d.NEMA = +d.NEMA;
				d.NEMATemp = +d.NEMATemp;
			});
			
			var lowDate = new Date(2015,4,1,1);
			var highDate = new Date(2015,5,1,1);
			
			var fdata = data.filter(function(d) {
  				return d.Date < highDate && d.Date > lowDate;
			})
			
			xScale.domain(d3.extent(fdata, function(d) {return d.Date;}));
			yScale.domain(d3.extent(fdata,function(d){return d.NEMA;}));
			tempScale.domain(d3.extent(fdata,function(d){return d.NEMATemp;}));
				      
			svg.append("path")
				.datum(fdata)
				.attr("class","line")
				.attr("d",valueLine(fdata));
				
			svg.append("path")
				.datum(fdata)
				.attr("class","tempLine")
				.attr("d",tempLine(fdata));
				
			svg.append("g")
				.attr("class","x axis")
				.attr("transform","translate(0,"+(h-margin)+")")
				.call(xAxis);
				
			svg.append("g")
				.attr("class","y axis")
				.attr("transform","translate("+margin+",0)")
				.call(yAxis);
				
			svg.append("g")
				.attr("class","temp axis")
				.attr("transform","translate("+(w-margin)+",0)")
				.call(tempAxis);
			
			d3.selectAll("input").on("change", function(){change(this.value,data);});
			
			function change(buttonValue,data){
				
				//var buttonValue = this.value;
				
				if (buttonValue === "0"){
					var lowDate = new Date(2015,0,1,1);
					var highDate = new Date(2015,5,30,23);
				}
				else{
					var lowDate = new Date(2015,6,1,1);
					var highDate = new Date(2015,11,31,23);
				}
				var fdata = data.filter(function(d) {
  					return d.Date < highDate && d.Date > lowDate;
				});
				console.log(highDate.getTime());
				xScale.domain(d3.extent(fdata, function(d) {return d.Date;}));
				yScale.domain(d3.extent(fdata,function(d){return d.NEMA;}));
				tempScale.domain(d3.extent(fdata,function(d){return d.NEMATemp;}));
				var t0 = svg.transition().duration(1000);
				t0.selectAll(".line").attr("d",valueLine(fdata));
				t0.selectAll(".tempLine").attr("d",tempLine(fdata));
				t0.selectAll(".y.axis").call(yAxis);
				t0.selectAll(".x.axis").call(xAxis);
				t0.selectAll(".temp.axis").call(tempAxis);
			}
			
		});
		
		
		
		
	</script>
	</body>
</html>
